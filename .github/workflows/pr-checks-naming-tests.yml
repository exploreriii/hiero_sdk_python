---
name: Test File Naming

on:
  pull_request:
    types:
      - "opened"
      - "reopened"
      - "edited"
      - "synchronize"

jobs:
  test-name-check:
    name: Test File Naming Check
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Harden the runner (Audit all outbound calls)
        # v2.13.1
        uses: step-security/harden-runner@f4a75cfd619ee5ce8d5b864b0d183aff3c69b55a
        with:
          egress-policy: audit

      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Validate test file naming convention
        run: |
            echo "Checking for test files that don't end with _test.py..."
            invalid_tests=$(find tests -type f -name "*.py" \
            ! -name "*_test.py" \
            ! -path "tests/integration/__init__.py" \
            ! -path "tests/unit/conftest.py" \
            ! -path "tests/unit/mock_server.py" \
            ! -path "tests/unit/__init__.py" \
            ! -path "tests/__init__.py" \
            || true)
            if [ -n "$invalid_tests" ]; then
            echo "The following test files don't follow (*_test.py):"
            echo "$invalid_tests"
            echo ""
            echo "Please rename them as *_test.py."
            exit 1
            else
            echo "All test files follow *_test.py naming convention."
            fi